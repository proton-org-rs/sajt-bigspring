{{ $src := .Get "src" }}
{{ $class := .Get "class" | default "" }}
{{ $alt := .Get "alt" | default "Image" }}
{{ $width := .Get "width" | default "800" }}
{{ $height := .Get "height" | default "0" }}
{{ $format := .Get "format" | default "webp" }}

{{ $img := resources.Get $src }}
{{ $resized := $img }}  <!-- define variable outside blocks -->

{{ if eq $height "0" }}
    {{ $resized = $img.Resize (printf "%sx %s" $width $format) }}
{{ else }}
    {{ $resized = $img.Fit (printf "%sx%s %s" $width $height $format) }}
{{ end }}

<img 
    src="{{ $resized.RelPermalink }}" 
    alt="{{ $alt }}" 
    width="{{ $resized.Width }}" 
    height="{{ $resized.Height }}" 
    loading="lazy"
    class="{{ $class }}">
